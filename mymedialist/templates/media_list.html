{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<h1>{{ title }}</h1>

<!-- Controls above the table -->
<div class="list-controls">
    <button id="addEntryBtn">Add Entry</button>

    <div class="sort-menu">
        <label for="sortSelect">Sort by:</label>
        <select id="sortSelect">
            <option value="title">Title (A-Z)</option>
            <option value="rating">Rating (High -> Low)</option>
        </select>
    </div>
</div>

<!-- Tabs for filtering by status -->
<div class="tabs">
    {% for status in ["All", "Completed", "In Progress", "Planned", "Dropped"] %}
    <button class="tab {% if loop.first %}active{% endif %}" data-status="{{ status }}">
        {{ status }}
    </button>
    {% endfor %}
</div>

<!-- Table -->
<table class="media-table">
    <thead>
        <tr>
            <th>Title</th>
            <th>Rating</th>
        </tr>
    </thead>
    <tbody>
        {% for entry in entries %}
        <tr data-status="{{ entry.status }}">
            <td class="title-cell">
                <span class="title-text">{{ entry.media.title }}</span>
                <button class="edit-btn" data-entry-id="{{ entry.id }}"
                    data-title="{{ entry.media.title }}"
                    data-rating="{{ entry.rating if entry.rating is not none else '' }}"
                    data-status="{{ entry.status }}" data-notes="{{ entry.notes or '' }}"
                    data-progress="{{ entry.progress_value if entry.progress_value is not none else '' }}">
                    Edit
                </button>
            </td>
            <td>
                {% if entry.rating is not none %}
                {{ entry.rating }}
                {% else %}
                -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Entry Modal  -->
<div id="entryModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modalTitle">Add New Entry</h2>
        <p class="privacy-note">*Your list is private by default.</p>
        <form id="entryForm" method="POST"
            action="{{ url_for('lists.add_entry', category=category) }}">

            <!-- Hidden field to store the entry_id-->
            <input type="hidden" name="entry_id" id="entryId">

            <div>
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" required>
            </div>

            <div>
                <label for="rating">Rating (1-10):</label>
                <select id="rating" name="rating">
                    <!-- optional dash for unrated -->
                    <option value="">-</option>
                    <!-- 1 through 10 rating -->
                    {% for i in range(1, 11) %}
                    <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="status">Status:</label>
                <select id="status" name="status">
                    <option value="In Progress">In Progress</option>
                    <option value="Completed">Completed</option>
                    <option value="Planned">Planned</option>
                    <option value="Dropped">Dropped</option>
                </select>
            </div>

            <div>
                <label for="notes">Notes (optional)</label>
                <textarea id="notes" name="notes" rows="3"></textarea>
            </div>

            <div class="form-buttons">
                <button type="submit" id="saveBtn">Add Entry</button>
                <button type="button" id="deleteBtn" class="delete-btn">Delete Entry</button>
        </form>
    </div>
</div>

<script>
  window.MEDIA_LIST_CONFIG = {
    addUrl: "{{ url_for('lists.add_entry', category=category) }}",
    editUrl: "{{ url_for('lists.edit_entry', category=category, entry_id=0) }}".replace(/0$/, ""),
    deleteUrl: "{{ url_for('lists.delete_entry', category=category, entry_id=0) }}".replace(/0$/, "")
  };
</script>

<script src="{{ url_for('static', filename='js/media_list.js') }}"></script>


{% endblock %}