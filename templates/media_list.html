{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<h1>{{ title }}</h1>

<!-- Add Entry Button -->
<div class="list-controls">
    <button id="addEntryBtn">Add Entry</button>
</div>

<!-- Tabs for filtering by status -->
<div class="tabs">
    {% for status in statuses %}
    <button class="tab {% if loop.first %}active{% endif %}" data-status="{{ status }}">
        {{ status }}
    </button>
    {% endfor %}
</div>

<!-- Table -->
<table class="media-table">
    <thead>
        <tr>
            {% for header in headers %}
            <th>{{ header }}</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for item in items %}
        <tr data-status="{{ item['Status'] }}">
            <td>{{ item['Title'] }}</td>
            <td>
                {% if item['Status'] == 'Completed' and item['Rating'] is not none %}
                {{ item['Rating'] }}
                {% else %}
                -
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Add Entry Modal -->
<div id="addEntryModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Entry</h2>
        <p class="privacy-note">*Your list is private by default.</p>
        <form method="POST" action="{{ url_for('add_entry', category=category) }}">
            <div>
                <label for="title">Title:</label>
                <input type="text" id="title" name="title" required>
            </div>

            <div>
                <label for="rating">Rating (1-10):</label>
                <select id="rating" name="rating">
                    <!-- optional dash for unrated -->
                    <option value="">-</option>
                    <!-- 1 through 10 rating -->
                    {% for i in range(1, 11) %}
                    <option value="{{ i }}">{{ i }}</option>
                    {% endfor %}
                </select>
            </div>

            <div>
                <label for="status">Status:</label>
                <select id="status" name="status">
                    {% for s in statuses if s != "All" %}
                    <option value="{{ s }}">{{ s }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit">Add Entry</button>
        </form>
    </div>
</div>

<!-- JS -->
<script>
    // Tab switching logic 
    const tabs = document.querySelectorAll(".tab");
    const rows = document.querySelectorAll("tbody tr");

    tabs.forEach(tab => {
        tab.addEventListener("click", () => {
            tabs.forEach(t => t.classList.remove("active"));
            tab.classList.add("active");
            const status = tab.dataset.status;
            rows.forEach(r => {
                r.style.display = (status === "All" || r.dataset.status === status) ? "" : "none";
            });
        });
    });

    // Modal open/close logic
    const modal = document.getElementById("addEntryModal");
    const btn = document.getElementById("addEntryBtn");
    const closeBtn = document.querySelector(".close");

    btn.onclick = () => modal.style.display = "block";
    closeBtn.onclick = () => modal.style.display = "none";
    window.onclick = (event) => {
        if (event.target === modal) modal.style.display = "none";
    };
</script>

{% endblock %}